<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cellular Platformer</title>

  <link rel="stylesheet" href="./style.css" />

  <!-- Retro font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <!-- WATCHDOG: runs even if main.js never loads -->
  <script>
    window.__BOOT_JS_OK = false;

    function bootShowError(msg) {
      const sub = document.getElementById("bootSub");
      const warn = document.getElementById("bootWarn");
      if (sub) sub.textContent = "JavaScript not running";
      if (warn) {
        warn.style.display = "block";
        warn.textContent = msg;
      }
    }

    // After a moment, if main.js didn't flip the flag, show why.
    setTimeout(() => {
      if (window.__BOOT_JS_OK) return;

      // If opened via file://, modules will fail.
      if (location.protocol === "file:") {
        bootShowError(
          "You opened this as a file (file://).\n\n" +
          "ES Modules won't load from file://.\n" +
          "Open the GitHub Pages URL instead:\n" +
          "https://YOURNAME.github.io/YOURREPO/\n"
        );
        return;
      }

      bootShowError(
        "main.js did not load.\n\n" +
        "Most likely causes:\n" +
        "1) GitHub Pages is serving from the wrong folder (Settings → Pages)\n" +
        "2) main.js path/name mismatch (must be next to index.html)\n" +
        "3) Cached old deployment (hard refresh Ctrl/Cmd+Shift+R)\n\n" +
        "Quick test:\n" +
        "Open this in a new tab:\n" +
        location.origin + location.pathname.replace(/\\/[^\\/]*$/, '/') + "main.js\n" +
        "If you see a 404 page or HTML, the path/settings are wrong.\n"
      );
    }, 1200);
  </script>

  <!-- Module script (with an onerror that shows on-screen message) -->
  <script type="module" src="./main.js"
    onerror="bootShowError('main.js failed to load (404 or wrong Pages folder).\\n\\nGo to Settings → Pages and confirm it is serving from the branch root (/) where index.html + main.js live.')">
  </script>
</head>

<body>
  <div class="page">
    <header class="topbar">
      <div class="title">Cellular Platformer</div>
      <div class="controls">
        Move: &larr;/&rarr; or A/D · Jump: Space · Throw: F · Dash: Shift · Pause: Esc
      </div>
    </header>

    <main class="shell">
      <div class="frame" id="frame">
        <canvas id="game" width="1280" height="720"></canvas>

        <div class="overlayRoot" id="overlayRoot">

          <!-- BOOT / LOADING -->
          <div class="overlay overlay--show" id="bootOverlay">
            <div class="card">
              <div class="cardTitle">CELLULAR PLATFORMER</div>
              <div class="cardSub" id="bootSub">Waiting for JavaScript…</div>

              <div class="progress">
                <div class="progressFill" id="bootBar"></div>
              </div>

              <div class="small" id="bootText">0%</div>
              <div class="small dim" id="bootFile">—</div>

              <div class="warn small" id="bootWarn" style="display:none; white-space:pre-wrap;"></div>

              <div class="row">
                <button class="btn" id="bootStartBtn" disabled>START</button>
              </div>
              <div class="small dim">Assets must be in <b>/assets</b>.</div>
            </div>
          </div>

          <!-- CHARACTER SELECT -->
          <div class="overlay" id="charOverlay">
            <div class="card wide">
              <div class="cardTitle">CHOOSE YOUR CHARACTER</div>
              <div class="cardSub">Tutorial runs once on Level 1.</div>
              <div class="grid" id="charGrid"></div>
              <div class="row">
                <button class="btn" id="charStartBtn" disabled>START RUN</button>
              </div>
            </div>
          </div>

        </div>
      </div>

      <div class="hudbar">
        <div class="pill">Level: <b id="hudLevel">1</b></div>
        <div class="pill">Coins: <b id="hudCoins">0</b></div>
        <div class="pill">Dash: <b id="hudDash">Locked</b></div>
        <div class="pill">Speed: <b id="hudSpeed">Normal</b></div>
        <div class="pill">Throw: <b id="hudThrow">Ready</b></div>
        <div class="pill right">HP: <b id="hudHP">10/10</b></div>
      </div>

      <footer class="footer">
        Made with HTML Canvas · Hosted on GitHub Pages
      </footer>
    </main>
  </div>

  <noscript>This game needs JavaScript enabled.</noscript>
</body>
</html>
